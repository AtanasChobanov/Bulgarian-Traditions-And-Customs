@model BulgarianTraditionsAndCustoms.Models.Traditions.Tradition

@{
	ViewData["Title"] = "Details";
}

<div class="container">
	<section id="post">
		<!-- Heading -->
		<h1 class="mb-3 fw-bold">
			@Model.Name
		</h1>

		<!-- Metadata -->
		<ul class="d-flex flex-wrap align-items-center gap-4 text-muted mb-3 ps-1 metadata-list">
			<li>
				@Model.CelebrationDate.ToString("dd MMMM")
			</li>
			<li>
				<span class="badge bg-primary text-white">
					@Html.DisplayFor(modelItem => Model.TraditionType)
				</span>
			</li>
			<li>
				<i class="bi bi-geo-alt-fill"></i>
				@Html.DisplayFor(modelItem => Model.Region)
			</li>
		</ul>
		<hr />

		<!-- Image -->
		@if (Model.ImagePath != null)
		{
			<div class="mb-4">
				<img src="@Model.ImagePath"
					 alt="@Model.Name"
					 class="img-fluid w-100 rounded"
					 style="max-height: 60vh; object-fit: cover;">
			</div>
		}

		<!-- Description -->
		<div class="fs-5 lh-lg">
			@Model.Description
		</div>

		<br />
		<hr />
		<br />

		<h4>Празници</h4>

		@if (Model.Holidays.Any())
		{
			<table class="table table-sm">
				<thead>
					<tr>
						<th>Име</th>
						<th>Описание</th>
						<th>Дата</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var holiday in Model.Holidays)
					{
						<tr>
							<td>@holiday.Name</td>
							<td>@holiday.Description</td>
							<td>@holiday.CelebrationDate</td>
						</tr>
					}
				</tbody>
			</table>
		}
		else
		{
			<p class="text-muted">Няма свързани празници</p>
		}

		<h4>Участници</h4>

		@if (Model.TraditionParticipants.Any())
		{
			<table class="table table-sm">
				<thead>
					<tr>
						<th>Име</th>
						<th>Роля</th>
						<th>Описание</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var tp in Model.TraditionParticipants)
					{
						<tr>
							<td>@tp.Participant.Name</td>
							<td>@(tp.ParticipantRole ?? tp.Participant.Role ?? "—")</td>
							<td>@tp.Participant.Description</td>
						</tr>
					}
				</tbody>
			</table>
		}
		else
		{
			<p class="text-muted">Няма добавени участници</p>
		}

		<div class="mt-4 d-flex justify-content-between align-items-center">

			<!-- Back to index -->
			<a asp-action="Index" asp-controller="Traditions" class="btn btn-outline-secondary">
				<i class="bi bi-arrow-left"></i>
				Към каталога
			</a>

			@if (User.IsInRole("Admin"))
			{
				<!-- Action buttons -->
				<div role="group" aria-label="Действия върху традицията">
					<a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
						<i class="bi bi-pencil-square"></i>
						Редактиране
					</a>

					<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal-@Model.Id">
						<i class="bi bi-trash"></i>
						Изтриване
					</button>
				</div>
			}
		</div>
		@if (User.IsInRole("Admin"))
		{
			<partial name="_DeleteModal" model='new DeleteModalViewModel { Id = Model.Id, EntityName = Model.Name, DisplayTitle = "традицията", Controller = "Traditions" }' />
		}
	</section>
</div>
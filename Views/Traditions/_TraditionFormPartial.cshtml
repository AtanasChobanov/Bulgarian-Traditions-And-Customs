@model BulgarianTraditionsAndCustoms.ViewModels.Traditions.TraditionFormViewModel;

<div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

<!-- Section 1: Core Information -->
<div class="glass-form-card">
	<div class="form-floating mb-4">
		<input asp-for="Tradition.Name" class="form-control border-0 bg-light rounded-3 fw-bold" placeholder="Име" />
		<label asp-for="Tradition.Name">Име на традицията</label>
		<span asp-validation-for="Tradition.Name" class="text-danger"></span>
	</div>

	<div class="row g-3">
		<div class="col-md-4">
			<div class="form-floating">
				<input asp-for="Tradition.CelebrationDate" type="date" class="form-control border-0 bg-light rounded-3" />
				<label asp-for="Tradition.CelebrationDate">Дата</label>
				<span asp-validation-for="Tradition.CelebrationDate" class="text-danger"></span>
			</div>
		</div>
		<div class="col-md-4">
			<div class="form-floating">
				<select asp-for="Tradition.TraditionType" asp-items="Model.TraditionTypes" class="form-select border-0 bg-light rounded-3"></select>
				<label asp-for="Tradition.TraditionType">Тип традиция</label>
				<span asp-validation-for="Tradition.TraditionType" class="text-danger"></span>
			</div>
		</div>
		<div class="col-md-4">
			<div class="form-floating">
				<select asp-for="Tradition.Region" asp-items="Model.Regions" class="form-select border-0 bg-light rounded-3"></select>
				<label asp-for="Tradition.Region">Регион</label>
				<span asp-validation-for="Tradition.Region" class="text-danger"></span>
			</div>
		</div>
	</div>
</div>

<!-- Section 2: Media -->
<div class="glass-form-card">
	<h4 class="fw-bold mb-4"><i class="bi bi-image me-2 text-success"></i>Медия</h4>
	<p class="text-muted small mb-3">Качете представителна снимка за традицията. Тя ще бъде основният визуален елемент в каталога.</p>
	
	<div class="upload-box overflow-hidden position-relative mb-2" id="uploadBox">
		<input asp-for="ImageFile" type="file" class="d-none" id="imageFileInput" accept="image/*" />
		<input asp-for="RemoveImage" type="hidden" id="removeImageInput" />
		
		<div class="upload-box-content text-center @(!string.IsNullOrEmpty(Model.Tradition.ImagePath) ? "d-none" : "")" id="uploadPlaceholder">
			<i class="bi bi-image display-4 text-success mb-2"></i>
			<h5 class="fw-bold">Кликнете за избор на снимка</h5>
			<p class="text-muted small">Поддържани формати: JPG, PNG, WEBP</p>
		</div>
		
		<img src="@Model.Tradition.ImagePath" id="formImagePreview" class="w-100 h-100 @(string.IsNullOrEmpty(Model.Tradition.ImagePath) ? "d-none" : "")" style="object-fit: contain; background: #f8f9fa;" />
	</div>

	<div class="upload-actions-bar @(string.IsNullOrEmpty(Model.Tradition.ImagePath) ? "d-none" : "")" id="uploadActionsBar">
		<button type="button" class="btn btn-light btn-sm rounded-pill shadow-sm border" id="changeImageBtn">
			<i class="bi bi-pencil me-1"></i> Смяна на снимката
		</button>
		<button type="button" class="btn btn-red-outline btn-sm rounded-pill shadow-sm" id="removeImageBtn">
			<i class="bi bi-trash me-1"></i> Премахни
		</button>
	</div>
	<span asp-validation-for="ImageFile" class="text-danger"></span>
</div>

<!-- Section 3: Description -->
<div class="glass-form-card">
	<h4 class="fw-bold mb-4"><i class="bi bi-text-left me-2 text-success"></i>Описание</h4>
	<div class="form-floating">
		<textarea asp-for="Tradition.Description" class="form-control border-0 bg-light rounded-3" style="height: 200px" placeholder="Описание"></textarea>
		<label asp-for="Tradition.Description">Разкажете историята на тази традиция...</label>
		<span asp-validation-for="Tradition.Description" class="text-danger"></span>
	</div>
</div>

<!-- Section 4: Participants Selection -->
@if (Model?.Participants != null && Model.Participants.Any())
{
	<div class="glass-form-card">
		<h4 class="fw-bold mb-4"><i class="bi bi-people me-2 text-success"></i>Участници в традицията</h4>
		<p class="text-muted small mb-4">Изберете участниците и дефинирайте техните роли.</p>
		<div class="row g-3 overflow-auto custom-scrollbar pe-2" style="max-height: 480px;">
			@foreach (var p in Model.Participants)
			{
				var isSelected = Model.SelectedParticipantIds.Contains(p.Id);
				<div class="col-md-6 col-xl-4">
					<div class="relation-card @(isSelected ? "selected" : "")" data-id="@p.Id">
						<input type="checkbox" name="SelectedParticipantIds" value="@p.Id" 
							   class="d-none relation-checkbox" @(isSelected ? "checked" : "") />
						
						<div class="avatar">
							@if (!string.IsNullOrEmpty(p.ImagePath))
							{
								<img src="@p.ImagePath" alt="@p.Name" />
							}
							else
							{
								<i class="bi bi-person text-muted"></i>
							}
						</div>

						<div class="flex-grow-1">
							<div class="fw-bold small mb-1">@p.Name</div>
							<input type="text" name="ParticipantRoles[@p.Id]" 
								   class="role-badge-input @(isSelected ? "" : "d-none")" 
								   placeholder="Роля..." 
								   value="@(isSelected ? Model.ParticipantRoles[p.Id] : "")" />
						</div>

						<div class="check-icon">
							<i class="bi bi-check-circle-fill text-success @(isSelected ? "" : "d-none")"></i>
						</div>
					</div>
				</div>
			}
		</div>
	</div>
}

<!-- Section 5: Holidays Selection -->
@if (Model?.Holidays != null && Model.Holidays.Any())
{
	<div class="glass-form-card">
		<h4 class="fw-bold mb-4"><i class="bi bi-calendar-check me-2 text-success"></i>Свързани празници</h4>
		<p class="text-muted small mb-4">Изберете празниците, на които се изпълнява тази традиция.</p>
		<div class="row g-3 overflow-auto custom-scrollbar pe-2" style="max-height: 400px;">
			@foreach (var h in Model.Holidays)
			{
				var isSelected = Model.SelectedHolidayIds.Contains(h.Id);
				<div class="col-md-6 col-xl-4">
					<div class="relation-card @(isSelected ? "selected" : "")" data-id="@h.Id">
						<input type="checkbox" name="SelectedHolidayIds" value="@h.Id" 
							   class="d-none relation-checkbox" @(isSelected ? "checked" : "") />
						
						<div class="avatar bg-light-green">
							<i class="bi bi-calendar-event text-success"></i>
						</div>

						<div class="flex-grow-1">
							<div class="fw-bold small">@h.Name</div>
							<div class="text-muted smaller">@h.CelebrationDate?.ToString("dd MMMM")</div>
						</div>

						<div class="check-icon">
							<i class="bi bi-check-circle-fill text-success @(isSelected ? "" : "d-none")"></i>
						</div>
					</div>
				</div>
			}
		</div>
	</div>
}

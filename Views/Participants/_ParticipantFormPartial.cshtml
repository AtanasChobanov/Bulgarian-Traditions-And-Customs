@model BulgarianTraditionsAndCustoms.ViewModels.Participants.ParticipantFormViewModel;

<div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

<!-- Section 1: Core Information -->
<div class="glass-form-card">
	<div class="form-floating mb-0">
		<input asp-for="Participant.Name" class="form-control border-0 bg-light rounded-3 fw-bold" placeholder="Име" />
		<label asp-for="Participant.Name">Име на участника</label>
		<span asp-validation-for="Participant.Name" class="text-danger"></span>
	</div>
</div>

<!-- Section 2: Media -->
<div class="glass-form-card">
	<h4 class="fw-bold mb-4"><i class="bi bi-image me-2 text-success"></i>Медия</h4>
	<p class="text-muted small mb-3">Качете снимка на участника, по която той ще бъде разпознаван в каталога.</p>
	
	<div class="upload-box overflow-hidden position-relative mb-2" id="uploadBox">
		<input asp-for="ImageFile" type="file" class="d-none" id="imageFileInput" accept="image/*" />
		<input asp-for="RemoveImage" type="hidden" id="removeImageInput" />
		
		<div class="upload-box-content text-center @(!string.IsNullOrEmpty(Model.Participant.ImagePath) ? "d-none" : "")" id="uploadPlaceholder">
			<i class="bi bi-image display-4 text-success mb-2"></i>
			<h5 class="fw-bold">Кликнете за избор на снимка</h5>
			<p class="text-muted small">Поддържани формати: JPG, PNG, WEBP</p>
		</div>
		
		<img src="@Model.Participant.ImagePath" id="formImagePreview" class="w-100 h-100 @(string.IsNullOrEmpty(Model.Participant.ImagePath) ? "d-none" : "")" style="object-fit: contain; background: #f8f9fa;" />
	</div>

	<div class="upload-actions-bar @(string.IsNullOrEmpty(Model.Participant.ImagePath) ? "d-none" : "")" id="uploadActionsBar">
		<button type="button" class="btn btn-light btn-sm rounded-pill shadow-sm border" id="changeImageBtn">
			<i class="bi bi-pencil me-1"></i> Смяна на снимката
		</button>
		<button type="button" class="btn btn-red-outline btn-sm rounded-pill shadow-sm" id="removeImageBtn">
			<i class="bi bi-trash me-1"></i> Премахни
		</button>
	</div>
	<span asp-validation-for="ImageFile" class="text-danger"></span>
</div>

<!-- Section 3: Description -->
<div class="glass-form-card">
	<h4 class="fw-bold mb-4"><i class="bi bi-text-left me-2 text-success"></i>Описание</h4>
	<div class="form-floating">
		<textarea asp-for="Participant.Description" class="form-control border-0 bg-light rounded-3" style="height: 200px" placeholder="Описание"></textarea>
		<label asp-for="Participant.Description">Кратка биография или описание на ролята...</label>
		<span asp-validation-for="Participant.Description" class="text-danger"></span>
	</div>
</div>

<!-- Section 4: Traditions Selection -->
@if (Model?.Traditions != null && Model.Traditions.Any())
{
	<div class="glass-form-card">
		<h4 class="fw-bold mb-4"><i class="bi bi-journal-check me-2 text-success"></i>Традиции, в които участва</h4>
		<p class="text-muted small mb-4">Изберете традициите и ролята на участника в тях.</p>
		<div class="row g-3 overflow-auto custom-scrollbar pe-2" style="max-height: 480px;">
			@foreach (var t in Model.Traditions)
			{
				var isSelected = Model.SelectedTraditionIds.Contains(t.Id);
				<div class="col-md-6 col-xl-4">
					<div class="relation-card @(isSelected ? "selected" : "")" data-id="@t.Id">
						<input type="checkbox" name="SelectedTraditionIds" value="@t.Id" 
							   class="d-none relation-checkbox" @(isSelected ? "checked" : "") />
						
						<div class="avatar">
							@if (!string.IsNullOrEmpty(t.ImagePath))
							{
								<img src="@t.ImagePath" alt="@t.Name" />
							}
							else
							{
								<i class="bi bi-image text-muted"></i>
							}
						</div>

						<div class="flex-grow-1">
							<div class="fw-bold small">@t.Name</div>
							<div class="text-muted smaller mb-1">@t.CelebrationDate?.ToString("dd MMMM")</div>
							<input type="text" name="ParticipantRoles[@t.Id]" 
								   class="role-badge-input @(isSelected ? "" : "d-none")" 
								   placeholder="Роля..." 
								   value="@(isSelected ? Model.ParticipantRoles[t.Id] : "")" />
						</div>

						<div class="check-icon">
							<i class="bi bi-check-circle-fill text-success @(isSelected ? "" : "d-none")"></i>
						</div>
					</div>
				</div>
			}
		</div>
	</div>
}

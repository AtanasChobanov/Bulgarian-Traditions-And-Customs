@model BulgarianTraditionsAndCustoms.ViewModels.ParticipantIndexViewModel

@{
	ViewData["Title"] = "Index";

	// Дефинираме променливите веднъж в началото.
	var prevDisabled = !Model.Participants.HasPreviousPage ? "disabled" : "";
	var nextDisabled = !Model.Participants.HasNextPage ? "disabled" : "";
}

<div class="container">
	<section id="header">
		<div class="text-center">
			<h2>Участници в български традиции</h2>
		</div>
	</section>

	<div class="row">
		<section id="main" class="col-8">
			@foreach (var item in Model.Participants)
			{
				<div class="card mb-3">
					@if (item.ImagePath != null)
					{
						<img src="@item.ImagePath" class="card-img-top" alt="Снимка на @item.Name">
					}
					<div class="card-body container">
						<div class="row">
							<div class="col">
								<h5 class="card-title">@item.Name</h5>
							</div>
						</div>
						<div class="row">
							<p class="card-text">@item.Description</p>
						</div>
					</div>
					<div class="card-footer">
						<div class="container">
							<div class="row">
								@if (User.IsInRole("Admin"))
								{
									<div class="col">
										<a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning">Редактиране</a>
										<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal-@item.Id">Изтриване</button>
									</div>
								}
								<div class="col text-end">
									<a asp-action="Details" asp-route-id="@item.Id" class="btn btn-primary">Прочети още</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				@if (User.IsInRole("Admin"))
				{
					<partial name="_ParticipantDeleteModal" model="item" />
				}
			}
			@* --- НАЧАЛО НА НАВИГАЦИЯТА ЗА СТРАНИЦИТЕ --- *@

			<!-- Бутон "Предишна" -->
			<a asp-action="Index"
			   asp-route-pageNumber="@(Model.Participants.PageIndex - 1)"
			   asp-route-sortOrder="@Model.FilterQuery.SortOrder"
			   asp-route-pageSize="@Model.FilterQuery.PageSize"
			   asp-route-searchString="@Model.FilterQuery.SearchString"
			   class="btn btn-outline-primary @prevDisabled">
				« Предишна
			</a>

			<!-- Линкове с номерата на страниците -->
			@for (var i = 1; i <= Model.Participants.TotalPages; i++)
			{
				@*
				    За всеки номер на страница (от 1 до TotalPages), създаваме линк.
				    Ако номерът на страницата 'i' съвпада с текущата страница 'Model.PageIndex',
				    ще му дадем различен CSS клас, за да го откроим визуално.
				*@
				<a asp-action="Index"
				   asp-route-pageNumber="@i"
				   asp-route-sortOrder="@Model.FilterQuery.SortOrder"
				   asp-route-pageSize="@Model.FilterQuery.PageSize"
				   asp-route-searchString="@Model.FilterQuery.SearchString"
				   class="btn @(i == Model.Participants.PageIndex ? "btn-primary" : "btn-outline-primary")">
					@i
				</a>
			}

			<!-- Бутон "Следваща" -->
			<a asp-action="Index"
			   asp-route-pageNumber="@(Model.Participants.PageIndex + 1)"
			   asp-route-sortOrder="@Model.FilterQuery.SortOrder"
			   asp-route-pageSize="@Model.FilterQuery.PageSize"
			   asp-route-searchString="@Model.FilterQuery.SearchString"
			   class="btn btn-outline-primary @nextDisabled">
				Следваща »
			</a>
		</section>
		<section id="filter" class="col-4 text-end">
			@if (User.IsInRole("Admin"))
			{
				<a asp-action="Create" class="btn btn-outline-primary w-100">Създай нова статия</a>
			}

			<div class="d-flex">
				<div class="dropdown">
					<span>Подреди по:</span>
					<button class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
						Избери
					</button>
					<ul class="dropdown-menu">
						<li>
							<a class="dropdown-item"
							   asp-action="Index"
							   asp-route-sortOrder="name_asc"
							   asp-route-pageSize="@Model.FilterQuery.PageSize"
							   asp-route-searchString="@Model.FilterQuery.SearchString">Име ↑</a>
						</li>
						<li>
							<a class="dropdown-item"
							   asp-action="Index"
							   asp-route-sortOrder="name_desc"
							   asp-route-pageSize="@Model.FilterQuery.PageSize"
							   asp-route-searchString="@Model.FilterQuery.SearchString">Име ↓</a>
						</li>
					</ul>
				</div>
				<div class="dropdown">
					<span>Покажи:</span>
					<button class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
						@Model.FilterQuery.PageSize
					</button>
					<ul class="dropdown-menu">
						<li>
							<a class="dropdown-item"
							   asp-action="Index"
							   asp-route-pageSize="5"
							   asp-route-sortOrder="@Model.FilterQuery.SortOrder"
							   asp-route-searchString="@Model.FilterQuery.SearchString">5</a>
						</li>
						<li>
							<a class="dropdown-item"
							   asp-action="Index"
							   asp-route-pageSize="10"
							   asp-route-sortOrder="@Model.FilterQuery.SortOrder"
							   asp-route-searchString="@Model.FilterQuery.SearchString">10</a>
						</li>
						<li>
							<a class="dropdown-item"
							   asp-action="Index"
							   asp-route-pageSize="15"
							   asp-route-sortOrder="@Model.FilterQuery.SortOrder"
							   asp-route-searchString="@Model.FilterQuery.SearchString">15</a>
						</li>
					</ul>
				</div>
			</div>

			<div class="card shadow-sm text-start">
				<div class="card-body">
					<form asp-controller="Participants" asp-action="Index" method="get" id="filter">
						<div class="col-md-4 w-100">
							<div class="input-group">
								<input type="text"
									   name="searchString"
									   value="@Model.FilterQuery.SearchString"
									   class="form-control"
									   placeholder="Търси по име..." />

								<button class="btn btn-primary" type="submit">
									<i class="bi bi-search"></i>
								</button>
							</div>
						</div>

						<!-- SUBMIT -->
						<button type="submit" class="btn btn-primary w-100">
							Приложи филтри
						</button>

					</form>

				</div>
			</div>
		</section>
	</div>
</div>